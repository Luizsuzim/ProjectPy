{% extends "base.html" %}

{% block title %}Clientes{% endblock %}

{% block content %}
<div class="container">
    <h1>Clientes</h1>

    <form id="formCliente">
        <input type="text" id="nome" placeholder="Nome" required>
        <input type="text" id="telefone" placeholder="Telefone" required>
        <button type="submit">Cadastrar</button>
    </form>

    <ul id="listaClientes"></ul>
</div>

<script>
let clienteEditando = null;

async function carregarClientes() {
    const resposta = await fetch("/api/clientes");
    const clientes = await resposta.json();

    const lista = document.getElementById("listaClientes");
    lista.innerHTML = "";

    clientes.forEach(cliente => {
        const li = document.createElement("li");

        li.innerHTML = `
            ${cliente.nome} - ${cliente.telefone}
            <button onclick="editar(${cliente.id}, '${cliente.nome}', '${cliente.telefone}')">‚úèÔ∏è</button>
            <button onclick="excluir(${cliente.id})">üóëÔ∏è</button>
        `;

        lista.appendChild(li);
    });
}

function editar(id, nome, telefone) {
    document.getElementById("nome").value = nome;
    document.getElementById("telefone").value = telefone;
    clienteEditando = id;
}

async function excluir(id) {
    if (!confirm("Deseja excluir este cliente?")) return;

    await fetch(`/api/clientes/${id}`, {
        method: "DELETE"
    });

    carregarClientes();
}

document.getElementById("formCliente").addEventListener("submit", async (e) => {
    e.preventDefault();

    const nome = document.getElementById("nome").value;
    const telefone = document.getElementById("telefone").value;

    if (clienteEditando) {
        await fetch(`/api/clientes/${clienteEditando}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nome, telefone })
        });

        clienteEditando = null;
    } else {
        await fetch("/api/clientes", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nome, telefone })
        });
    }

    e.target.reset();
    carregarClientes();
});

carregarClientes();
</script>
{% endblock %}
